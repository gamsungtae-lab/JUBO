<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì£¼ë³´ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        /* í† ìŠ¤ ìŠ¤íƒ€ì¼ ì»¬ëŸ¬ ë° í°íŠ¸ ì •ì˜ */
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: #F2F4F6; /* í† ìŠ¤ ë°°ê²½ìƒ‰ */
            color: #191F28; /* í† ìŠ¤ ë¸”ë™ */
        }
        
        /* ì¹´ë“œ ë””ìì¸ */
        .toss-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s ease;
        }
        
        /* ì…ë ¥ì°½ ë””ìì¸ */
        .toss-input {
            background-color: #F9FAFB;
            border: 1px solid transparent;
            border-radius: 16px;
            transition: all 0.2s ease;
            color: #333D4B;
        }
        .toss-input:focus {
            background-color: white;
            border-color: #3182F6; /* í† ìŠ¤ ë¸”ë£¨ */
            box-shadow: 0 0 0 2px rgba(49, 130, 246, 0.1);
            outline: none;
        }
        
        /* ë²„íŠ¼ ë””ìì¸ */
        .toss-btn {
            background-color: #3182F6;
            color: white;
            border-radius: 16px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .toss-btn:active { background-color: #1B64DA; }
        
        /* ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
        .modal-enter { opacity: 0; transform: translateY(20px); }
        .modal-active { opacity: 1; transform: translateY(0); transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</head>
<body class="antialiased min-h-screen pb-10">

<div class="max-w-xl mx-auto">
    
    <header class="sticky top-0 z-20 bg-[#F2F4F6]/90 backdrop-blur-md px-6 py-4 flex justify-between items-center mb-2">
        <div>
            <h1 class="text-2xl font-bold text-[#191F28]">ì£¼ë³´ ì‘ì„±</h1>
        </div>
        <button onclick="toggleViewMode()" class="bg-white text-[#3182F6] px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-gray-50 transition flex items-center gap-2">
            <i class="fas fa-list"></i> ì ‘ìˆ˜ í˜„í™©
        </button>
    </header>

    <main class="px-5 space-y-6">
        <form id="juboForm" class="space-y-6">
            
            <div class="toss-card p-6 space-y-5">
                <div>
                    <label class="block text-sm font-bold text-[#8B95A1] mb-2 pl-1">ë‚ ì§œ</label>
                    <input type="date" id="targetDate" class="toss-input w-full p-4 text-lg font-bold" required>
                </div>

                <div>
                    <label class="block text-sm font-bold text-[#8B95A1] mb-2 pl-1">ë¶€ì„œ</label>
                    <div class="relative">
                        <select id="department" class="toss-input w-full p-4 text-lg appearance-none font-bold" onchange="updateFormFields()" required>
                            <option value="">ì–´ë”” ë¶€ì„œì¸ê°€ìš”?</option>
                            
                            <optgroup label="ğŸµ ì°¬ì–‘ ë° ì˜ˆë°°">
                                <option value="worship_1">1ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                                <option value="worship_23">2-3ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                                <option value="choir_all">ì°¬ì–‘ëŒ€ (ì „ì²´)</option>
                            </optgroup>

                            <optgroup label="ğŸ“– ì„¤êµ">
                                <option value="sermon_4">4ë¶€ ì˜ˆë°° ì„¤êµ</option>
                                <option value="sermon_5">5ë¶€ ì˜ˆë°° ì„¤êµ</option>
                                <option value="sermon_pm">ì˜¤í›„ì˜ˆë°° ì„¤êµ</option>
                                <option value="sermon_wed_am">ìˆ˜ìš”ì˜¤ì „ ì„¤êµ</option>
                                <option value="sermon_wed_pm">ìˆ˜ìš”ì €ë… ì„¤êµ</option>
                            </optgroup>

                            <optgroup label="ğŸŒ± ë‹¤ìŒì„¸ëŒ€ (ì…ë ¥ ê°„ì†Œí™”)">
                                <option value="youth">ì²­ë…„ë¶€</option>
                                <option value="school">êµíšŒí•™êµ</option>
                            </optgroup>

                            <optgroup label="ğŸ“¢ ê¸°íƒ€">
                                <option value="news">ê´‘ê³  / ì†Œì‹</option>
                                <option value="service">ë´‰ì‚¬ / ê¸°íƒ€</option>
                            </optgroup>
                        </select>
                        <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-400">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-[#8B95A1] mb-2 pl-1">ì‘ì„±ì</label>
                    <input type="text" id="writer" placeholder="ì˜ˆ: ê¹€ì² ìˆ˜ ì „ë„ì‚¬" class="toss-input w-full p-4 font-medium" required>
                </div>
            </div>

            <div id="dynamicFields" class="hidden toss-card p-6 space-y-4 animate-fade">
                </div>

            <button type="submit" id="submitBtn" class="toss-btn w-full py-4 text-lg shadow-lg shadow-blue-500/20 transform active:scale-95 transition-transform">
                ë³´ë‚´ê¸°
            </button>
        </form>
    </main>

    <div id="viewModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none">
        <div id="modalBackdrop" class="absolute inset-0 bg-black/40 backdrop-blur-sm opacity-0 transition-opacity duration-300" onclick="toggleViewMode()"></div>
        
        <div id="modalContent" class="modal-enter relative bg-[#F2F4F6] w-full max-w-lg h-[90vh] sm:h-[80vh] rounded-t-[28px] sm:rounded-[28px] shadow-2xl flex flex-col overflow-hidden pointer-events-auto">
            
            <div class="bg-white p-5 flex justify-between items-center border-b border-gray-100 rounded-t-[28px]">
                <h2 class="text-xl font-bold text-[#191F28] pl-2">ì ‘ìˆ˜ í˜„í™©</h2>
                <button onclick="toggleViewMode()" class="w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="viewContent" class="flex-1 overflow-y-auto p-5 space-y-4">
                <div class="flex flex-col items-center justify-center h-full text-gray-400 gap-3">
                    <i class="fas fa-spinner fa-spin text-2xl text-[#3182F6]"></i>
                    <p class="font-medium">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // ğŸ”´ [í•„ìˆ˜] ì—¬ê¸°ì— ë³¸ì¸ì˜ êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ URLì„ ë„£ìœ¼ì„¸ìš”!
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxAItLf7sBsBhX-VIcTWruv1ukt8XSR-qNMy_GesNUhPQQFvDkCoztFQqDVNSrXrYuu/exec'; 

    // ë‚ ì§œ ìë™ ì„¤ì •
    const today = new Date(); 
    const nextSun = new Date(today.setDate(today.getDate() + (7 - today.getDay()) % 7 || 7));
    document.getElementById('targetDate').valueAsDate = nextSun;

    // 1. ì…ë ¥ì°½ ë³€ê²½ ë¡œì§
    function updateFormFields() {
        const dept = document.getElementById('department').value;
        const div = document.getElementById('dynamicFields');
        div.innerHTML = ''; 
        
        if (!dept) { div.classList.add('hidden'); return; }
        div.classList.remove('hidden');

        let html = '';

        // Case A: êµíšŒí•™êµ OR ì²­ë…„ë¶€ (ìš”ì²­í•˜ì‹  ëŒ€ë¡œ íƒ­ ë¶„ë¦¬ + ì…ë ¥ ê°„ì†Œí™”)
        if (dept === 'school' || dept === 'youth') {
            const label = dept === 'youth' ? 'ì²­ë…„ë¶€' : 'êµíšŒí•™êµ';
            html = `
                <div>
                    <h3 class="text-lg font-bold text-[#3182F6] mb-1">${label} ì†Œì‹</h3>
                    <p class="text-sm text-gray-400 mb-3">ë¶€ì„œëª… ì…ë ¥ ì—†ì´ ë‚´ìš©ë§Œ ì ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.</p>
                    <textarea id="longText" rows="6" class="toss-input w-full p-4 resize-none" placeholder="ê´‘ê³  ë‚´ìš©, ëª¨ì„ ì¥ì†Œ, ë³´ê³  ì‚¬í•­ ë“±ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”."></textarea>
                </div>
            `;
        }
        // Case B: ì„¤êµ
        else if (dept.includes('sermon')) {
            html = `
                <h3 class="text-lg font-bold text-[#191F28] mb-3">ì„¤êµ ì •ë³´</h3>
                <input id="field1" class="toss-input w-full p-4 mb-3" placeholder="ì„±ê²½ ë³¸ë¬¸ (ì˜ˆ: ìš” 3:16)">
                <input id="field2" class="toss-input w-full p-4" placeholder="ì„¤êµ ì œëª©">
            `;
        }
        // Case C: ì°¬ì–‘
        else if (dept.includes('worship') || dept === 'choir_all') {
            let ph = "ê³¡ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            if (dept === 'choir_all') ph = "ì˜ˆì‹œ:\n1ë¶€: ê³¡ëª…\n2ë¶€: ê³¡ëª…\n3ë¶€: ê³¡ëª…";
            html = `
                <h3 class="text-lg font-bold text-[#191F28] mb-3">ì°¬ì–‘ ì½˜í‹°</h3>
                <textarea id="longText" rows="6" class="toss-input w-full p-4 resize-none" placeholder="${ph}"></textarea>
            `;
        }
        // Case D: ë‰´ìŠ¤/ë´‰ì‚¬
        else {
            let sub = dept === 'news' 
                ? `<select id="field1" class="toss-input w-full p-4 mb-3"><option>êµíšŒì†Œì‹</option><option>ê¸°ê´€ì†Œì‹</option><option>ëª¨ì§‘</option></select>` 
                : `<input id="field1" class="toss-input w-full p-4 mb-3" placeholder="ë´‰ì‚¬/ë¶€ì„œëª…">`;
            
            html = `${sub}<textarea id="longText" rows="5" class="toss-input w-full p-4 resize-none" placeholder="ë‚´ìš© ì…ë ¥"></textarea>`;
        }
        div.innerHTML = html;
    }

    // 2. í¼ ì œì¶œ ë¡œì§
    document.getElementById('juboForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = 'ì „ì†¡ ì¤‘...'; btn.disabled = true;

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({
                targetDate: document.getElementById('targetDate').value,
                department: document.getElementById('department').value,
                writer: document.getElementById('writer').value,
                field1: document.getElementById('field1')?.value || '',
                field2: document.getElementById('field2')?.value || '',
                longText: document.getElementById('longText')?.value || ''
            }),
            mode: 'no-cors'
        }).then(() => {
            alert('âœ… ì œì¶œ ì™„ë£Œ!'); window.location.reload();
        });
    });

    // 3. ì „ì²´ë³´ê¸°(ëª¨ë‹¬) ë¡œì§
    function toggleViewMode() {
        const backdrop = document.getElementById('modalBackdrop');
        const content = document.getElementById('modalContent');
        const container = document.getElementById('viewModal');
        const isOpen = content.classList.contains('modal-active');
        
        if (!isOpen) {
            // ì—´ê¸°
            container.style.pointerEvents = "auto";
            backdrop.style.opacity = "1";
            content.classList.add('modal-active');
            fetchData(); // ë°ì´í„° ë¡œë“œ
        } else {
            // ë‹«ê¸°
            backdrop.style.opacity = "0";
            content.classList.remove('modal-active');
            setTimeout(() => { container.style.pointerEvents = "none"; }, 300);
        }
    }

    // ë°ì´í„° ê°€ì ¸ì™€ì„œ ì¹´ë“œ ê·¸ë¦¬ê¸°
    function fetchData() {
        const container = document.getElementById('viewContent');
        const date = document.getElementById('targetDate').value;
        
        fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
            const filtered = data.filter(i => i.date.startsWith(date));
            container.innerHTML = '';
            
            if (!filtered.length) {
                container.innerHTML = `<div class="flex flex-col items-center justify-center h-64 text-gray-400 gap-3"><i class="far fa-folder-open text-4xl mb-2"></i><p>ì ‘ìˆ˜ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
                return;
            }

            filtered.forEach(item => {
                let copyText = "";
                if(item.department.includes('ì„¤êµ')) copyText = `[${item.department}]\nì œëª©: ${item.field2}\në³¸ë¬¸: ${item.field1}`;
                else copyText = `${item.department}\n${item.field1 ? item.field1+' ' : ''}${item.longText}`.trim();

                container.innerHTML += `
                    <div class="bg-white p-5 rounded-[20px] shadow-sm mb-4">
                        <div class="flex justify-between items-start mb-3">
                            <span class="font-bold text-[#191F28] text-lg">${item.department}</span>
                            <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-md font-medium">${item.writer}</span>
                        </div>
                        <div class="text-[#4E5968] text-sm space-y-2 mb-4">
                            ${item.field1 ? `<p class="font-semibold text-[#3182F6]">${item.field1}</p>` : ''}
                            ${item.field2 ? `<p class="font-bold text-black text-base">${item.field2}</p>` : ''}
                            ${item.longText ? `<p class="whitespace-pre-wrap bg-gray-50 p-3 rounded-xl border border-gray-100 leading-relaxed">${item.longText}</p>` : ''}
                        </div>
                        <button onclick="navigator.clipboard.writeText(\`${copyText.replace(/`/g, '')}\`).then(()=>alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))" class="w-full py-3 bg-[#F2F4F6] text-[#4E5968] font-bold rounded-xl text-sm hover:bg-[#E5E8EB] transition">
                            ë³µì‚¬í•˜ê¸°
                        </button>
                    </div>`;
            });
        });
    }
</script>
</body>
</html>
