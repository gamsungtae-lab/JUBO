<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì£¼ë³´ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; background-color: #F2F4F6; }
        
        /* íŠ¸ë Œë””í•œ ë””ìì¸ ìš”ì†Œ */
        .app-container { max-width: 600px; margin: 0 auto; min-height: 100vh; background: white; box-shadow: 0 0 40px rgba(0,0,0,0.05); }
        .input-box { transition: all 0.2s; border: 1px solid #E5E8EB; background: #F9FAFB; }
        .input-box:focus { border-color: #3182F6; background: white; box-shadow: 0 0 0 3px rgba(49, 130, 246, 0.1); outline: none; }
        .btn-primary { background: #3182F6; color: white; transition: transform 0.1s; }
        .btn-primary:active { transform: scale(0.98); }
        
        /* ëª¨ë‹¬ (ì „ì²´ë³´ê¸°) ì• ë‹ˆë©”ì´ì…˜ */
        .modal { transition: opacity 0.3s, transform 0.3s; pointer-events: none; opacity: 0; transform: translateY(20px); }
        .modal.active { pointer-events: all; opacity: 1; transform: translateY(0); }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #f0f0f0; }
    </style>
</head>
<body>

<div class="app-container relative">
    
    <header class="glass-header sticky top-0 z-10 px-6 py-4 flex justify-between items-center">
        <div>
            <h1 class="text-xl font-extrabold text-gray-900">â›ª ì£¼ë³´ ì‘ì„±</h1>
            <p class="text-xs text-gray-500 mt-0.5">ì´ë²ˆ ì£¼ ì£¼ë³´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
        </div>
        <button onclick="toggleViewMode()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm font-bold transition flex items-center gap-2">
            <i class="fas fa-list"></i> ì ‘ìˆ˜ í˜„í™©
        </button>
    </header>

    <main class="p-6 pb-20 space-y-6">
        <form id="juboForm" class="space-y-5">
            
            <div>
                <label class="block text-sm font-bold text-gray-600 mb-2">ğŸ“… ì£¼ë³´ ë‚ ì§œ</label>
                <input type="date" id="targetDate" class="input-box w-full p-4 rounded-xl text-lg font-medium text-gray-800" required>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-600 mb-2">ğŸ·ï¸ ë¶€ì„œ ì„ íƒ</label>
                <div class="relative">
                    <select id="department" class="input-box w-full p-4 rounded-xl text-gray-800 appearance-none font-medium" onchange="updateFormFields()" required>
                        <option value="">ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        
                        <optgroup label="ğŸŒ± ë‹¤ìŒì„¸ëŒ€ (ì…ë ¥ ê°„ì†Œí™”)">
                            <option value="youth">ì²­ë…„ë¶€</option>
                            <option value="school">êµíšŒí•™êµ</option>
                        </optgroup>

                        <optgroup label="ğŸµ ì°¬ì–‘ ë° ì˜ˆë°°">
                            <option value="worship_1">1ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                            <option value="worship_23">2-3ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                            <option value="choir_all">ì°¬ì–‘ëŒ€ (ì „ì²´)</option>
                        </optgroup>

                        <optgroup label="ğŸ“– ì„¤êµ">
                            <option value="sermon_4">4ë¶€ ì˜ˆë°° ì„¤êµ</option>
                            <option value="sermon_5">5ë¶€ ì˜ˆë°° ì„¤êµ</option>
                            <option value="sermon_pm">ì˜¤í›„ì˜ˆë°° ì„¤êµ</option>
                            <option value="sermon_wed_am">ìˆ˜ìš”ì˜¤ì „ ì„¤êµ</option>
                            <option value="sermon_wed_pm">ìˆ˜ìš”ì €ë… ì„¤êµ</option>
                        </optgroup>

                        <optgroup label="ğŸ“¢ ê¸°íƒ€">
                            <option value="news">ê´‘ê³  / ì†Œì‹</option>
                            <option value="service">ë´‰ì‚¬ / ê¸°íƒ€</option>
                        </optgroup>
                    </select>
                    <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-400">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-600 mb-2">âœï¸ ì‘ì„±ì</label>
                <input type="text" id="writer" placeholder="ì˜ˆ: ê¹€ì² ìˆ˜ ì „ë„ì‚¬" class="input-box w-full p-4 rounded-xl" required>
            </div>

            <div id="dynamicFields" class="hidden bg-blue-50 p-5 rounded-2xl border border-blue-100 space-y-3 animate-fade">
                </div>

            <button type="submit" id="submitBtn" class="btn-primary w-full py-4 rounded-xl text-lg font-bold shadow-lg shadow-blue-500/30 flex justify-center items-center gap-2">
                <span>ì œì¶œí•˜ê¸°</span> <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </main>

    <div id="viewModal" class="modal fixed inset-0 z-50 flex items-end sm:items-center justify-center sm:p-4">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="toggleViewMode()"></div>
        
        <div class="relative bg-white w-full max-w-lg h-[90vh] sm:h-auto sm:max-h-[85vh] rounded-t-3xl sm:rounded-3xl shadow-2xl flex flex-col overflow-hidden">
            <div class="p-5 border-b flex justify-between items-center bg-white sticky top-0 z-10">
                <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-clipboard-list text-blue-500"></i> ì ‘ìˆ˜ í˜„í™©</h2>
                <button onclick="toggleViewMode()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200"><i class="fas fa-times"></i></button>
            </div>
            
            <div id="viewContent" class="flex-1 overflow-y-auto p-5 space-y-4 bg-gray-50">
                <div class="text-center py-10 text-gray-400">
                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i><br>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // ğŸ”´ [í•„ìˆ˜] ì—¬ê¸°ì— ë³¸ì¸ì˜ êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ URLì„ ë„£ìœ¼ì„¸ìš”!
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxAItLf7sBsBhX-VIcTWruv1ukt8XSR-qNMy_GesNUhPQQFvDkCoztFQqDVNSrXrYuu/exec'; 

    // ë‚ ì§œ ìë™ ì„¤ì •
    const today = new Date(); 
    const nextSun = new Date(today.setDate(today.getDate() + (7 - today.getDay()) % 7 || 7));
    document.getElementById('targetDate').valueAsDate = nextSun;

    // 1. ì…ë ¥ì°½ ë³€ê²½ ë¡œì§ (ì²­ë…„ë¶€/êµíšŒí•™êµ ìš”êµ¬ì‚¬í•­ ë°˜ì˜!)
    function updateFormFields() {
        const dept = document.getElementById('department').value;
        const div = document.getElementById('dynamicFields');
        div.innerHTML = ''; 
        
        if (!dept) { div.classList.add('hidden'); return; }
        div.classList.remove('hidden');

        let html = '';

        // Case A: êµíšŒí•™êµ OR ì²­ë…„ë¶€ (ë¶€ì„œëª… ì…ë ¥ì¹¸ ì‚­ì œë¨! ë‚´ìš©ë§Œ í¬ê²Œ!)
        if (dept === 'school' || dept === 'youth') {
            const label = dept === 'youth' ? 'ì²­ë…„ë¶€' : 'êµíšŒí•™êµ';
            html = `
                <div>
                    <label class="text-xs font-bold text-blue-600 mb-1 block">ğŸ“¢ ${label} ì†Œì‹ ë° ë³´ê³ </label>
                    <textarea id="longText" rows="6" class="input-box w-full p-3 rounded-xl resize-none" placeholder="ê´‘ê³  ë‚´ìš©, ëª¨ì„ ì¥ì†Œ, ë³´ê³  ì‚¬í•­ ë“±ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”."></textarea>
                </div>
            `;
        }
        // Case B: ì„¤êµ
        else if (dept.includes('sermon')) {
            html = `
                <input id="field1" class="input-box w-full p-3 rounded-xl mb-3" placeholder="ì„±ê²½ ë³¸ë¬¸ (ì˜ˆ: ìš” 3:16)">
                <input id="field2" class="input-box w-full p-3 rounded-xl" placeholder="ì„¤êµ ì œëª©">
            `;
        }
        // Case C: ì°¬ì–‘
        else if (dept.includes('worship') || dept === 'choir_all') {
            let ph = "ê³¡ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            if (dept === 'choir_all') ph = "ì˜ˆì‹œ:\n1ë¶€: ê³¡ëª…\n2ë¶€: ê³¡ëª…\n3ë¶€: ê³¡ëª…";
            html = `<textarea id="longText" rows="6" class="input-box w-full p-3 rounded-xl resize-none" placeholder="${ph}"></textarea>`;
        }
        // Case D: ë‰´ìŠ¤/ë´‰ì‚¬
        else {
            let sub = dept === 'news' 
                ? `<select id="field1" class="input-box w-full p-3 rounded-xl mb-3"><option>êµíšŒì†Œì‹</option><option>ê¸°ê´€ì†Œì‹</option><option>ëª¨ì§‘</option></select>` 
                : `<input id="field1" class="input-box w-full p-3 rounded-xl mb-3" placeholder="ë´‰ì‚¬/ë¶€ì„œëª…">`;
            
            html = `${sub}<textarea id="longText" rows="5" class="input-box w-full p-3 rounded-xl resize-none" placeholder="ë‚´ìš© ì…ë ¥"></textarea>`;
        }
        div.innerHTML = html;
    }

    // 2. í¼ ì œì¶œ ë¡œì§
    document.getElementById('juboForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const originalBtn = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì „ì†¡ ì¤‘...'; btn.disabled = true;

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({
                targetDate: document.getElementById('targetDate').value,
                department: document.getElementById('department').value,
                writer: document.getElementById('writer').value,
                field1: document.getElementById('field1')?.value || '',
                field2: document.getElementById('field2')?.value || '',
                longText: document.getElementById('longText')?.value || ''
            }),
            mode: 'no-cors'
        }).then(() => {
            alert('âœ… ì œì¶œ ì™„ë£Œ!'); window.location.reload();
        });
    });

    // 3. ì „ì²´ë³´ê¸°(ëª¨ë‹¬) ë¡œì§
    function toggleViewMode() {
        const modal = document.getElementById('viewModal');
        const isOpen = modal.classList.contains('active');
        
        if (!isOpen) {
            modal.classList.add('active');
            fetchData(); // ì—´ ë•Œ ë°ì´í„° ê°€ì ¸ì˜´
        } else {
            modal.classList.remove('active');
        }
    }

    // ë°ì´í„° ê°€ì ¸ì™€ì„œ ì¹´ë“œ ê·¸ë¦¬ê¸°
    function fetchData() {
        const container = document.getElementById('viewContent');
        const date = document.getElementById('targetDate').value;
        
        fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
            const filtered = data.filter(i => i.date.startsWith(date));
            container.innerHTML = '';
            
            if (!filtered.length) {
                container.innerHTML = `<div class="text-center py-10 text-gray-400"><i class="far fa-folder-open text-3xl mb-2"></i><p>ì ‘ìˆ˜ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
                return;
            }

            filtered.forEach(item => {
                // ë³µì‚¬ ë‚´ìš© í¬ë§·
                let copyText = "";
                if(item.department.includes('ì„¤êµ')) copyText = `[${item.department}]\nì œëª©: ${item.field2}\në³¸ë¬¸: ${item.field1}`;
                else copyText = `${item.department}\n${item.field1 ? item.field1+' ' : ''}${item.longText}`.trim();

                // ì¹´ë“œ HTML
                container.innerHTML += `
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-gray-800 text-lg">${item.department}</span>
                            <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-lg">${item.writer}</span>
                        </div>
                        <div class="text-gray-600 text-sm space-y-1 mb-4">
                            ${item.field1 ? `<p class="font-medium text-blue-600">${item.field1}</p>` : ''}
                            ${item.field2 ? `<p class="font-bold text-gray-800">${item.field2}</p>` : ''}
                            ${item.longText ? `<p class="whitespace-pre-wrap bg-gray-50 p-3 rounded-lg">${item.longText}</p>` : ''}
                        </div>
                        <button onclick="navigator.clipboard.writeText(\`${copyText.replace(/`/g, '')}\`).then(()=>alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))" class="w-full py-3 bg-gray-50 hover:bg-blue-50 text-gray-600 hover:text-blue-600 font-bold rounded-xl text-sm transition">
                            <i class="far fa-copy"></i> ë‚´ìš© ë³µì‚¬
                        </button>
                    </div>`;
            });
        });
    }
</script>
</body>
</html>
