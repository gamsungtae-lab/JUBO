<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë³´ ì»¨í…ì¸  ì‘ì„±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .input-field { transition: all 0.3s ease; }
        .input-field:focus { box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); border-color: #6366f1; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 min-h-screen flex items-center justify-center p-4 md:p-6">

    <div class="w-full max-w-xl glass-effect rounded-3xl shadow-2xl overflow-hidden border border-white/50 relative">
        
        <div class="bg-indigo-600 p-6 flex justify-between items-center text-white">
            <div>
                <h1 class="text-2xl font-bold tracking-tight">â›ª ì£¼ë³´ ì‘ì„±</h1>
                <p class="text-indigo-200 text-xs mt-1">ì´ë²ˆ ì£¼ ì£¼ë³´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            </div>
            <a href="./view.html" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-xl text-sm font-bold transition flex items-center gap-2 backdrop-blur-sm">
                <i class="fas fa-list-ul"></i> ì „ì²´ë³´ê¸°
            </a>
        </div>

        <form id="juboForm" class="p-6 md:p-8 space-y-6">
            
            <div class="space-y-2">
                <label class="text-sm font-bold text-gray-600 ml-1 flex items-center gap-2">
                    <i class="far fa-calendar-alt text-indigo-500"></i> ì£¼ë³´ ë‚ ì§œ
                </label>
                <input type="date" id="targetDate" class="input-field w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none text-gray-700 font-medium" required>
            </div>

            <div class="space-y-2">
                <label class="text-sm font-bold text-gray-600 ml-1 flex items-center gap-2">
                    <i class="fas fa-tag text-indigo-500"></i> ë¶€ì„œ ì„ íƒ
                </label>
                <div class="relative">
                    <select id="department" class="input-field w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none text-gray-700 font-medium appearance-none" onchange="updateFormFields()">
                        <option value="">ë‹´ë‹¹ ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        
                        <optgroup label="ğŸµ ì°¬ì–‘ ë° ì˜ˆë°°">
                            <option value="worship_1">1ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                            <option value="worship_23">2-3ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                            <option value="choir_all">ì°¬ì–‘ëŒ€ (í†µí•©)</option>
                        </optgroup>

                        <optgroup label="ğŸ“– ì„¤êµ (ì œëª©/ë³¸ë¬¸)">
                            <option value="sermon_4">4ë¶€ ì˜ˆë°° ì„¤êµ</option>
                            <option value="sermon_5">5ë¶€ ì˜ˆë°° ì„¤êµ</option>
                            <option value="sermon_pm">ì˜¤í›„ì˜ˆë°° ì„¤êµ</option>
                            <option value="sermon_wed_am">ìˆ˜ìš”ì˜¤ì „ ì„¤êµ</option>
                            <option value="sermon_wed_pm">ìˆ˜ìš”ì €ë… ì„¤êµ</option>
                        </optgroup>

                        <optgroup label="ğŸ« ë‹¤ìŒì„¸ëŒ€">
                            <option value="school">êµíšŒí•™êµ / ì²­ë…„ë¶€</option>
                        </optgroup>

                        <optgroup label="ğŸ“¢ ì†Œì‹ ë° ê¸°íƒ€">
                            <option value="news">ê´‘ê³  / êµìš°ì†Œì‹</option>
                            <option value="service">ë´‰ì‚¬ / ì‹ë‹¹ / ê¸°íƒ€</option>
                        </optgroup>
                    </select>
                    <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-400">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-sm font-bold text-gray-600 ml-1 flex items-center gap-2">
                    <i class="fas fa-user-edit text-indigo-500"></i> ì‘ì„±ì
                </label>
                <input type="text" id="writer" placeholder="ì§ë¶„ í¬í•¨ (ì˜ˆ: ê¹€ì² ìˆ˜ ì „ë„ì‚¬)" class="input-field w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none text-gray-700 font-medium" required>
            </div>

            <div id="dynamicFields" class="hidden space-y-4 bg-indigo-50/50 p-5 rounded-2xl border border-indigo-100 animate-fade-in">
                </div>

            <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-2xl shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex justify-center items-center gap-2">
                <span>ì œì¶œí•˜ê¸°</span> <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>

    <script>
        // âš ï¸ [ìˆ˜ì •í•„ìˆ˜] êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”!
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxAItLf7sBsBhX-VIcTWruv1ukt8XSR-qNMy_GesNUhPQQFvDkCoztFQqDVNSrXrYuu/exec'; 

        // ë‚ ì§œ ìë™ ì„¤ì • (ë‹¤ìŒì£¼ ì¼ìš”ì¼)
        const today = new Date(); 
        const nextSun = new Date(today.setDate(today.getDate() + (7 - today.getDay()) % 7 || 7));
        document.getElementById('targetDate').valueAsDate = nextSun;

        // ë¶€ì„œ ì„ íƒì— ë”°ë¥¸ ì…ë ¥ì°½ ë³€ê²½ ë¡œì§
        function updateFormFields() {
            const dept = document.getElementById('department').value;
            const div = document.getElementById('dynamicFields');
            
            if (!dept) {
                div.classList.add('hidden');
                return;
            }
            
            div.innerHTML = ''; 
            div.classList.remove('hidden');
            let html = '';

            // A. ì„¤êµ (ë³¸ë¬¸ + ì œëª©)
            if (dept.includes('sermon')) {
                html = `
                    <div>
                        <label class="text-xs font-bold text-indigo-500 mb-1 block">ì„±ê²½ ë³¸ë¬¸</label>
                        <input id="field1" class="input-field w-full p-3 bg-white border border-indigo-100 rounded-xl" placeholder="ì˜ˆ: ìš”í•œë³µìŒ 3:16">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-indigo-500 mb-1 block">ì„¤êµ ì œëª©</label>
                        <input id="field2" class="input-field w-full p-3 bg-white border border-indigo-100 rounded-xl" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                `;
            }
            // B. êµíšŒí•™êµ/ì²­ë…„ë¶€ (ë¶€ì„œëª… ì…ë ¥ì¹¸ ì‚­ì œ! ë‚´ìš©ë§Œ í¬ê²Œ!)
            else if (dept === 'school') {
                html = `
                    <div>
                        <label class="text-xs font-bold text-indigo-500 mb-1 block">ì†Œì‹ ë° ë³´ê³  ë‚´ìš©</label>
                        <textarea id="longText" rows="6" class="input-field w-full p-3 bg-white border border-indigo-100 rounded-xl resize-none" placeholder="ì´ë²ˆ ì£¼ ë¶€ì„œ ì†Œì‹, ëª¨ì„ ì¥ì†Œ ë“±ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”."></textarea>
                    </div>
                `;
            }
            // C. ì°¬ì–‘ (ì…ë ¥ì°½ í•˜ë‚˜)
            else if (dept.includes('worship') || dept === 'choir_all') {
                let placeholder = "ì½˜í‹°(ê³¡ëª…)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                if (dept === 'choir_all') placeholder = "ì˜ˆì‹œ:\n1ë¶€: ì£¼ëŠ” ì € ì‚° ë°‘ì—\n2ë¶€: ì˜í™”ë¡­ë„ë‹¤\n3ë¶€: í• ë ë£¨ì•¼";
                
                html = `
                    <div>
                        <label class="text-xs font-bold text-indigo-500 mb-1 block">ì°¬ì–‘ ê³¡ëª…</label>
                        <textarea id="longText" rows="6" class="input-field w-full p-3 bg-white border border-indigo-100 rounded-xl resize-none" placeholder="${placeholder}"></textarea>
                    </div>
                `;
            }
            // D. ë‰´ìŠ¤/ë´‰ì‚¬ (ë¶„ë¥˜ + ë‚´ìš©)
            else {
                let subInput = "";
                // ë‰´ìŠ¤ëŠ” ì„ íƒë°•ìŠ¤
                if(dept === 'news') {
                    subInput = `
                        <div class="mb-3">
                            <label class="text-xs font-bold text-indigo-500 mb-1 block">ê´‘ê³  ë¶„ë¥˜</label>
                            <select id="field1" class="input-field w-full p-3 bg-white border border-indigo-100 rounded-xl">
                                <option>êµíšŒì†Œì‹</option><option>ê¸°ê´€ì†Œì‹</option><option>ëª¨ì§‘</option><option>êµìš°ì†Œì‹</option>
                            </select>
                        </div>`;
                } 
                // ë´‰ì‚¬ëŠ” ë´‰ì‚¬ëª… ì…ë ¥
                else {
                    subInput = `
                        <div class="mb-3">
                            <label class="text-xs font-bold text-indigo-500 mb-1 block">ë´‰ì‚¬/ë¶€ì„œëª…</label>
                            <input id="field1" class="input-field w-full p-3 bg-white border border-indigo-100 rounded-xl" placeholder="ì˜ˆ: ì‹ë‹¹ë´‰ì‚¬, ì°¨ëŸ‰íŒ€">
                        </div>`;
                }

                html = `
                    ${subInput}
                    <div>
                        <label class="text-xs font-bold text-indigo-500 mb-1 block">ìƒì„¸ ë‚´ìš©</label>
                        <textarea id="longText" rows="6" class="input-field w-full p-3 bg-white border border-indigo-100 rounded-xl resize-none" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
                    </div>
                `;
            }

            div.innerHTML = html;
        }

        // í¼ ì œì¶œ
        document.getElementById('juboForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì „ì†¡ ì¤‘...';
            btn.disabled = true;
            btn.classList.add('opacity-70', 'cursor-not-allowed');

            const data = {
                targetDate: document.getElementById('targetDate').value,
                department: document.getElementById('department').value,
                writer: document.getElementById('writer').value,
                field1: document.getElementById('field1') ? document.getElementById('field1').value : '',
                field2: document.getElementById('field2') ? document.getElementById('field2').value : '',
                longText: document.getElementById('longText') ? document.getElementById('longText').value : ''
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(data),
                mode: 'no-cors'
            })
            .then(() => {
                alert('âœ… ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!');
                window.location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ì „ì†¡ ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-70', 'cursor-not-allowed');
            });
        });
    </script>
</body>
</html>
