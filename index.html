<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë³´ ì…ë ¥ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css'); body { font-family: 'Pretendard', sans-serif; }</style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-lg bg-white rounded-xl shadow-lg p-6">
        <h1 class="text-2xl font-bold text-center text-indigo-700 mb-6">â›ª ì£¼ë³´ ë‚´ìš© ì…ë ¥</h1>
        <form id="juboForm" class="space-y-4">
            <div><label class="block text-sm font-bold text-gray-700">ğŸ“… ì£¼ë³´ ë‚ ì§œ</label><input type="date" id="targetDate" class="w-full p-3 border rounded-lg" required></div>
            <div>
                <label class="block text-sm font-bold text-gray-700">ğŸ·ï¸ ë¶€ì„œ ì„ íƒ</label>
                <select id="department" class="w-full p-3 border rounded-lg" onchange="updateFormFields()">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <optgroup label="ì°¬ì–‘">
                        <option value="worship_1">1ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                        <option value="worship_23">2-3ë¶€ ê²½ë°°ì™€ì°¬ì–‘</option>
                        <option value="choir_all">ì°¬ì–‘ëŒ€ (ì „ì²´ í†µí•©)</option>
                    </optgroup>
                    <optgroup label="ì„¤êµ (ì œëª©/ë³¸ë¬¸)">
                        <option value="sermon_4">4ë¶€ ì„¤êµ</option>
                        <option value="sermon_5">5ë¶€ ì„¤êµ</option>
                        <option value="sermon_pm">ì˜¤í›„ì˜ˆë°° ì„¤êµ</option>
                        <option value="sermon_wed_am">ìˆ˜ìš”ì˜¤ì „ ì„¤êµ</option>
                        <option value="sermon_wed_pm">ìˆ˜ìš”ì €ë… ì„¤êµ</option>
                    </optgroup>
                    <optgroup label="ê¸°íƒ€">
                        <option value="school">êµíšŒí•™êµ/ì²­ë…„ë¶€</option>
                        <option value="news">ê´‘ê³ /ì†Œì‹</option>
                        <option value="service">ë´‰ì‚¬/ê¸°íƒ€</option>
                    </optgroup>
                </select>
            </div>
            <div><label class="block text-sm font-bold text-gray-700">âœï¸ ì‘ì„±ì</label><input type="text" id="writer" class="w-full p-3 border rounded-lg" placeholder="ì§ë¶„ í¬í•¨" required></div>
            
            <div id="dynamicFields" class="hidden space-y-3 bg-gray-50 p-4 rounded-lg border"></div>

            <button type="submit" id="submitBtn" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-lg hover:bg-indigo-700">ì œì¶œí•˜ê¸°</button>
        </form>
    </div>

    <script>
        // âš ï¸ ì—¬ê¸°ì— ì•„ê¹Œ ë³µì‚¬í•œ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxAItLf7sBsBhX-VIcTWruv1ukt8XSR-qNMy_GesNUhPQQFvDkCoztFQqDVNSrXrYuu/exec'; 

        const today = new Date(); const nextSun = new Date(today.setDate(today.getDate() + (7 - today.getDay()) % 7 || 7));
        document.getElementById('targetDate').valueAsDate = nextSun;

        function updateFormFields() {
            const dept = document.getElementById('department').value;
            const div = document.getElementById('dynamicFields');
            div.innerHTML = ''; div.classList.remove('hidden');
            let html = '';

            // 1. ì„¤êµ (ë³¸ë¬¸ + ì œëª© ì…ë ¥ì¹¸ ë‚˜ì˜´)
            if (dept.includes('sermon')) {
                html = `<input id="field1" class="w-full p-2 border rounded mb-2" placeholder="ì„±ê²½ ë³¸ë¬¸ (ì˜ˆ: ìš” 3:16)">
                        <input id="field2" class="w-full p-2 border rounded" placeholder="ì„¤êµ ì œëª©">`;
            }
            // 2. ê·¸ ì™¸ (ì°¬ì–‘ëŒ€, ê´‘ê³  ë“±ì€ ëª¨ë‘ í° ì…ë ¥ì°½ í•˜ë‚˜)
            else if (dept) {
                let placeholder = "ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                let subInput = "";
                
                if (dept === 'choir_all') placeholder = "ì˜ˆì‹œ:\n1ë¶€: ê³¡ëª…\n2ë¶€: ê³¡ëª…\n3ë¶€: ê³¡ëª…";
                else if (dept.includes('worship')) placeholder = "ì½˜í‹°(ê³¡ëª…)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                
                if (dept === 'news') subInput = `<select id="field1" class="w-full p-2 border rounded mb-2"><option>êµíšŒì†Œì‹</option><option>ê¸°ê´€ì†Œì‹</option><option>ëª¨ì§‘</option></select>`;
                else if (!dept.includes('worship') && dept !== 'choir_all') subInput = `<input id="field1" class="w-full p-2 border rounded mb-2" placeholder="ë¶€ì„œëª…/ë´‰ì‚¬ëª…">`;

                html = `${subInput}<textarea id="longText" rows="6" class="w-full p-2 border rounded" placeholder="${placeholder}"></textarea>`;
            } else {
                div.classList.add('hidden');
            }
            div.innerHTML = html;
        }

        document.getElementById('juboForm').addEventListener('submit', e => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn'); btn.innerText = 'ì „ì†¡ ì¤‘...'; btn.disabled = true;
            
            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({
                targetDate: document.getElementById('targetDate').value,
                department: document.getElementById('department').value,
                writer: document.getElementById('writer').value,
                field1: document.getElementById('field1')?.value || '', // ë³¸ë¬¸/ë¶„ë¥˜
                field2: document.getElementById('field2')?.value || '', // ì œëª©
                longText: document.getElementById('longText')?.value || '' // ê¸´ë‚´ìš©
            }), mode: 'no-cors' }).then(() => { alert('ì œì¶œ ì™„ë£Œ!'); window.location.reload(); });
        });
    </script>
</body>
</html>